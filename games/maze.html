<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maze Sequence Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        line-height: 1.6;
        text-align: center;
      }
      h1 {
        color: #333;
      }
      #maze-container {
        display: grid;
        grid-template-columns: repeat(10, 40px);
        grid-template-rows: repeat(10, 40px);
        gap: 5px;
        margin: 0 auto 20px;
        width: max-content;
      }
      .cell {
        width: 40px;
        height: 40px;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 18px;
      }
      .start {
        background-color: lightblue;
        font-weight: bold;
      }
      .wall {
        background-color: black;
      }
      .goal {
        background-color: lightgreen;
        font-weight: bold;
      }
      .goal-hit {
        background-color: lightcoral;
      }
      .jump {
        background-color: orange;
        font-weight: bold;
      }
      .player {
        background-color: red;
      }
      .controls {
        margin-top: 20px;
      }
      #command-input {
        font-size: 24px;
        padding: 10px;
        text-transform: uppercase;
        width: 500px;
        margin-bottom: 20px;
      }
      button {
        font-size: 24px;
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
      }
      button:hover {
        background-color: #45a049;
      }
      .timer {
        margin-top: 10px;
        font-weight: bold;
      }
      .instructions {
        margin-top: 20px;
        color: #555;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>Maze Sequence Game</h1>

    <div id="maze-container"></div>

    <div class="controls">
      <h3>Enter Instructions:</h3>
      <input
        type="text"
        id="command-input"
        placeholder="Enter a sequence like 'RRUUDDL'"
        maxlength="70"
      />
      <br />
      <button onclick="runProgram()">Run Program</button>
    </div>

    <div class="timer">
      <p>
        Time: <span id="time-elapsed">0</span>s | Moves:
        <span id="move-count">0</span>
      </p>
    </div>

    <div class="instructions">
      <h3>How to Play:</h3>
      <p>
        Enter a sequence of commands using **R** (right), **L** (left), **U**
        (up), and **D** (down).
      </p>
      <p>
        Your goal is to reach all the goal blocks (G1, G2, etc.)
        <b>in any order</b>, using the shortest path possible.
      </p>
      <p>
        If you land on a jump block, you will automatically be transported to
        its paired block.
      </p>
      <p>
        Avoid walls (black blocks), and get through the maze as fast as
        possible!
      </p>
    </div>

    <script>
      const mazeSize = 10;
      const walls = [];
      const jumps = [];
      const goals = [];
      const numJumpPairs = 5;
      const numGoalBlocks = 5;
      let startPos = { row: 0, col: 0 };
      let playerPos = { row: 0, col: 0 };
      let moveCount = 0;
      let timeElapsed = 0;
      let interval;
      const jumpPairs = Array(numJumpPairs)
        .fill()
        .map(() => []);
      const goalsHit = new Set();

      // Generate random positions
      function randomPos() {
        return {
          row: Math.floor(Math.random() * mazeSize),
          col: Math.floor(Math.random() * mazeSize),
        };
      }

      // Check if a position is valid (not a wall, goal, or jump)
      function isValidPosition(pos, array) {
        return !array.some(
          (item) => item.row === pos.row && item.col === pos.col
        );
      }

      // Initialize the maze
      function initializeMaze() {
        const mazeContainer = document.getElementById("maze-container");
        mazeContainer.innerHTML = ""; // Clear any previous maze

        // Place the start position randomly
        startPos = randomPos();
        playerPos = { ...startPos };

        // Add random walls (10 walls)
        while (walls.length < 10) {
          const wallPos = randomPos();
          if (
            isValidPosition(wallPos, walls) &&
            isValidPosition(wallPos, [startPos])
          ) {
            walls.push(wallPos);
          }
        }

        // Add configurable pairs of jump blocks
        for (let i = 0; i < numJumpPairs; i++) {
          while (jumpPairs[i].length < 2) {
            const jumpPos = randomPos();
            if (
              isValidPosition(jumpPos, jumpPairs.flat()) &&
              isValidPosition(jumpPos, walls) &&
              isValidPosition(jumpPos, [startPos])
            ) {
              jumpPairs[i].push(jumpPos);
            }
          }
        }

        // Add configurable goal blocks
        for (let i = 1; i <= numGoalBlocks; i++) {
          let goalPos;
          do {
            goalPos = randomPos();
          } while (
            !isValidPosition(goalPos, goals) ||
            !isValidPosition(goalPos, walls) ||
            !isValidPosition(goalPos, jumpPairs.flat())
          );
          goalPos.number = i;
          goals.push(goalPos);
        }

        // Render the maze
        for (let row = 0; row < mazeSize; row++) {
          for (let col = 0; col < mazeSize; col++) {
            const cell = document.createElement("div");
            cell.classList.add("cell");
            cell.id = `cell-${row}-${col}`;

            // Set the start position
            if (row === startPos.row && col === startPos.col) {
              cell.classList.add("start");
            }

            // Set walls
            if (walls.some((wall) => wall.row === row && wall.col === col)) {
              cell.classList.add("wall");
            }

            // Set jump blocks
            jumpPairs.forEach((pair, index) => {
              pair.forEach((jump) => {
                if (jump.row === row && jump.col === col) {
                  cell.classList.add("jump");
                  cell.textContent = `J${index + 1}`;
                }
              });
            });

            // Set goal blocks
            const goalBlock = goals.find(
              (goal) => goal.row === row && goal.col === col
            );
            if (goalBlock) {
              cell.classList.add("goal");
              cell.textContent = `G${goalBlock.number}`;
            }

            mazeContainer.appendChild(cell);
          }
        }

        updatePlayerPosition(); // Show player start position
      }

      // Move the player
      function movePlayer(direction) {
        let { row, col } = playerPos;
        if (direction === "u") row--;
        if (direction === "d") row++;
        if (direction === "l") col--;
        if (direction === "r") col++;

        // Check bounds
        if (row >= 0 && row < mazeSize && col >= 0 && col < mazeSize) {
          const isWall = walls.some(
            (wall) => wall.row === row && wall.col === col
          );
          if (!isWall) {
            playerPos.row = row;
            playerPos.col = col;
            moveCount++;
            document.getElementById("move-count").textContent = moveCount;
            checkJump();
            checkGoals();
          }
        }
        updatePlayerPosition();
      }

      // Update the player's visual position on the grid
      function updatePlayerPosition() {
        document.querySelectorAll(".cell").forEach((cell) => {
          cell.classList.remove("player");
        });
        const playerCell = document.getElementById(
          `cell-${playerPos.row}-${playerPos.col}`
        );
        if (playerCell) {
          playerCell.classList.add("player");
        }
      }

      // Check if the player lands on a jump block
      function checkJump() {
        const currentJump = jumpPairs
          .flat()
          .find(
            (jump) => jump.row === playerPos.row && jump.col === playerPos.col
          );
        if (currentJump) {
          const pairIndex = jumpPairs.findIndex((pair) =>
            pair.some((jump) => jump === currentJump)
          );
          const jumpTarget = jumpPairs[pairIndex].find(
            (jump) => jump !== currentJump
          );
          playerPos = { ...jumpTarget };
        }
      }

      // Check if the player reaches the goals in the correct order
      function checkGoals() {
        const currentGoal = goals.find(
          (goal) => goal.row === playerPos.row && goal.col === playerPos.col
        );
        if (currentGoal && !goalsHit.has(currentGoal.number)) {
          goalsHit.add(currentGoal.number);
          // Change goal color once hit
          const goalCell = document.getElementById(
            `cell-${currentGoal.row}-${currentGoal.col}`
          );
          if (goalCell) {
            goalCell.classList.remove("goal");
            goalCell.classList.add("goal-hit");
            goalCell.textContent = `G${currentGoal.number}`;
          }
        }

        // Only show the alert after the color has changed
        if (goalsHit.size === numGoalBlocks) {
          setTimeout(() => {
            clearInterval(interval);
            alert("Congratulations! You reached all goals.");
          }, 500); // Slight delay to ensure color change
        }
      }

      // Clean input and remove spaces, invalid characters
      function cleanInput(input) {
        return input.replace(/[^rlud]/gi, "").toUpperCase();
      }

      // Run the player's program (sequence of moves)
      function runProgram() {
        let commands = document.getElementById("command-input").value.trim();
        commands = cleanInput(commands); // Clean the input
        moveCount = 0;
        timeElapsed = 0;
        document.getElementById("move-count").textContent = moveCount;
        document.getElementById("time-elapsed").textContent = timeElapsed;

        clearInterval(interval);
        interval = setInterval(() => {
          timeElapsed++;
          document.getElementById("time-elapsed").textContent = timeElapsed;
        }, 1000);

        let index = 0;
        function executeNextCommand() {
          if (index < commands.length) {
            movePlayer(commands[index].toLowerCase());
            index++;
            setTimeout(executeNextCommand, 500); // Move every 0.5 seconds
          } else {
            clearInterval(interval);
            if (goalsHit.size < numGoalBlocks) {
              alert("Game Over! You did not reach all the goals.");
            }
          }
        }
        executeNextCommand();
      }

      // Initialize the game when the page loads
      initializeMaze();
    </script>
  </body>
</html>
